language: bash
dist: bionic

arch:
  - amd64
  - arm64
os: linux

git:
  depth: false

branches:
  only:
    - dev

env:
  global:
    - LC_ALL: C.UTF-8
    - LANG: C.UTF-8

addons:
  snaps:
    - name: snapcraft
      channel: stable
      confinement: classic
  apt:
    update: true
    sources:
      - sourceline: 'ppa:ymshenyu/grpc-1'
      - sourceline: 'deb http://archive.neon.kde.org/unstable bionic main'
        key_url: 'http://archive.neon.kde.org/public.key'

script:
  - sudo snapcraft --destructive-mode

after_failure:
  - sudo journalctl -u snapd

deploy:
  provider: snap
  snap: qv2ray_*.snap
  channel: edge
  skip_cleanup: true
  on:
    branch: dev